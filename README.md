# ğŸ” E2E-Toolï¼šåŸºäº GmSSL çš„å›½å¯†åŠ å¯†å·¥å…·

**E2E-Tool** æ˜¯ä¸€ä¸ªåŸºäº GmSSL å®ç°çš„å‘½ä»¤è¡ŒåŠ å¯†å·¥å…·ï¼Œæ”¯æŒå›½å¯† ZUC æµåŠ å¯†ã€SM2 å¯†é’¥å¯¹ç”Ÿæˆã€SM2 ECDH ä¼šè¯å¯†é’¥åå•†ç­‰åŠŸèƒ½ã€‚é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæµ‹è¯•ä»£ç ä¸äº§ç‰©é›†ä¸­ç®¡ç†ï¼Œä¾¿äºç»´æŠ¤å’Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚

æœ¬å·¥å…·é€‚ç”¨äºæ„å»ºç«¯åˆ°ç«¯åŠ å¯†ï¼ˆE2EEï¼‰ç³»ç»Ÿçš„"åŠ è§£å¯†æ¨¡å—"ï¼Œè¾“å‡ºä¸ºçº¯ç²¹çš„äºŒè¿›åˆ¶å¯†æ–‡ï¼Œä¾¿äºä¸ä¿¡æ¯éšè—æ¨¡å—å¯¹æ¥ã€‚

---

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„

```
e2e_tool/
â”œâ”€â”€ cli/                    # å‘½ä»¤è¡Œä¸»ç¨‹åºæºç 
â”‚   â””â”€â”€ main.c             # ä¸»ç¨‹åºå…¥å£ï¼ŒåŒ…å«æ‰€æœ‰å‘½ä»¤å¤„ç†é€»è¾‘
â”œâ”€â”€ include/               # å¤´æ–‡ä»¶
â”‚   â””â”€â”€ sm2_ecdh.h        # SM2 ECDH åŠŸèƒ½æ¥å£å£°æ˜
â”œâ”€â”€ src/                   # åº“å®ç°æºç 
â”‚   â””â”€â”€ sm2_ecdh.c        # SM2 å¯†é’¥ç”Ÿæˆå’Œ ECDH åå•†å®ç°
â”œâ”€â”€ test/                  # æµ‹è¯•ç›¸å…³å†…å®¹
â”‚   â”œâ”€â”€ test_sm2_ecdh.c   # å•å…ƒ/é›†æˆæµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ test_perf.py      # æ€§èƒ½æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ test_sm2_ecdh     # æµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶
â”‚   â””â”€â”€ data/             # æµ‹è¯•è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶
â”‚       â””â”€â”€ .gitkeep      # ä¿æŒç©ºç›®å½•å¯æäº¤
â”œâ”€â”€ e2e-tool              # ä¸»å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆé™æ€é“¾æ¥ GmSSLï¼‰
â”œâ”€â”€ Makefile              # æ„å»ºé…ç½®
â”œâ”€â”€ package.sh            # æ‰“åŒ…è„šæœ¬
â”œâ”€â”€ README.md             # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ .gitignore           # Git å¿½ç•¥é…ç½®
â””â”€â”€ test_perf.py         # æ€§èƒ½æµ‹è¯•è„šæœ¬ï¼ˆå·²ç§»è‡³ test/ï¼‰
```

**ç‰¹ç‚¹ï¼š**
- æ‰€æœ‰æµ‹è¯•äº§ç‰©ï¼ˆå¦‚ .pem/.key/.zuc/.txtï¼‰éƒ½é›†ä¸­åœ¨ `test/data/` ç›®å½•ä¸‹
- é™æ€é“¾æ¥ GmSSLï¼Œæ— éœ€ç”¨æˆ·å•ç‹¬å®‰è£…ä¾èµ–
- æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•

---

## ğŸ› ï¸ æ„å»ºæ–¹æ³•

### ç¯å¢ƒè¦æ±‚
- macOS æˆ– Linux ç³»ç»Ÿ
- GCC ç¼–è¯‘å™¨
- Python 3ï¼ˆä»…æ€§èƒ½æµ‹è¯•éœ€è¦ï¼‰

### ç¼–è¯‘æ­¥éª¤

```bash
# 1. ç¼–è¯‘ä¸»ç¨‹åº
make

# 2. ç¼–è¯‘æµ‹è¯•ç¨‹åº
make test

# 3. æ¸…ç†ç¼–è¯‘äº§ç‰©
make clean

# 4. æ‰“åŒ…åˆ†å‘
./package.sh
```

### Makefile ç›®æ ‡è¯´æ˜

| ç›®æ ‡ | è¯´æ˜ |
|------|------|
| `make` | ç¼–è¯‘ä¸»ç¨‹åº `e2e-tool` |
| `make test` | ç¼–è¯‘æµ‹è¯•ç¨‹åº `test/test_sm2_ecdh` |
| `make clean` | æ¸…ç†æ‰€æœ‰ç¼–è¯‘äº§ç‰© |
| `make all` | ç¼–è¯‘ä¸»ç¨‹åºå’Œæµ‹è¯•ç¨‹åº |

---

## ğŸš€ åŠŸèƒ½ä¸ä½¿ç”¨æ–¹æ³•

### 1. ç”Ÿæˆ SM2 å¯†é’¥å¯¹

**å‘½ä»¤æ ¼å¼ï¼š**
```bash
./e2e-tool gen-keys -priv <ç§é’¥æ–‡ä»¶> -pub <å…¬é’¥æ–‡ä»¶>
```

**ç¤ºä¾‹ï¼š**
```bash
# ç”Ÿæˆ Alice çš„å¯†é’¥å¯¹
./e2e-tool gen-keys -priv test/data/alice.pem -pub test/data/alice_pub.pem

# ç”Ÿæˆ Bob çš„å¯†é’¥å¯¹
./e2e-tool gen-keys -priv test/data/bob.pem -pub test/data/bob_pub.pem
```

**è¾“å‡ºï¼š**
```
[+] SM2 keypair generated:
    Private: test/data/alice.pem
    Public : test/data/alice_pub.pem
```

### 2. SM2 ECDH ä¼šè¯å¯†é’¥åå•†

**å‘½ä»¤æ ¼å¼ï¼š**
```bash
./e2e-tool key-exchange -priv <æˆ‘çš„ç§é’¥> -peer <å¯¹æ–¹å…¬é’¥> -out <ä¼šè¯å¯†é’¥æ–‡ä»¶>
```

**ç¤ºä¾‹ï¼š**
```bash
# Alice ä¸ Bob çš„å…¬é’¥åå•†ä¼šè¯å¯†é’¥
./e2e-tool key-exchange -priv test/data/alice.pem -peer test/data/bob_pub.pem -out test/data/alice_session.key

# Bob ä¸ Alice çš„å…¬é’¥åå•†ä¼šè¯å¯†é’¥
./e2e-tool key-exchange -priv test/data/bob.pem -peer test/data/alice_pub.pem -out test/data/bob_session.key
```

**éªŒè¯ ECDH æ­£ç¡®æ€§ï¼š**
```bash
# ä¸¤ä¸ªä¼šè¯å¯†é’¥åº”è¯¥å®Œå…¨ç›¸åŒ
diff test/data/alice_session.key test/data/bob_session.key
```

### 3. ZUC åŠ å¯†

**å‘½ä»¤æ ¼å¼ï¼š**
```bash
./e2e-tool encrypt -in <æ˜æ–‡æ–‡ä»¶> -out <å¯†æ–‡æ–‡ä»¶>
```

**ç¤ºä¾‹ï¼š**
```bash
# åˆ›å»ºæµ‹è¯•æ–‡ä»¶
echo "Hello, World!" > test/data/plain.txt

# åŠ å¯†
./e2e-tool encrypt -in test/data/plain.txt -out test/data/cipher.zuc
```

**è¾“å‡ºï¼š**
```
[+] Encryption successful
[+] Encrypted file: test/data/cipher.zuc
[+] Key saved to: zuc.key
```

### 4. ZUC è§£å¯†

**å‘½ä»¤æ ¼å¼ï¼š**
```bash
./e2e-tool decrypt -in <å¯†æ–‡æ–‡ä»¶> -out <æ˜æ–‡æ–‡ä»¶> -key <å¯†é’¥æ–‡ä»¶>
```

**ç¤ºä¾‹ï¼š**
```bash
# è§£å¯†
./e2e-tool decrypt -in test/data/cipher.zuc -out test/data/recovered.txt -key zuc.key

# éªŒè¯è§£å¯†ç»“æœ
diff test/data/plain.txt test/data/recovered.txt
```

**è¾“å‡ºï¼š**
```
[+] Decryption successful
[+] Decrypted file: test/data/recovered.txt
[+] Preview:
Hello, World!
```

### 5. æŸ¥çœ‹å¸®åŠ©

```bash
./e2e-tool
```

**è¾“å‡ºï¼š**
```
Usage:
  ./e2e-tool encrypt -in <input.txt> -out <output.zuc>
  ./e2e-tool decrypt -in <input.zuc> -out <output.txt> -key <zuc.key>
  ./e2e-tool gen-keys -priv <priv.pem> -pub <pub.pem>
  ./e2e-tool key-exchange -priv <my.pem> -peer <peer_pub.pem> -out <session.key>
```

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. è‡ªåŠ¨åŒ–å•å…ƒ/é›†æˆæµ‹è¯•

```bash
# ç¼–è¯‘æµ‹è¯•ç¨‹åº
make test

# è¿è¡Œæµ‹è¯•
./test/test_sm2_ecdh
```

**æµ‹è¯•å†…å®¹ï¼š**
- SM2 å¯†é’¥ç”Ÿæˆæµ‹è¯•
- SM2 ECDH å¯†é’¥åå•†æµ‹è¯•
- ZUC åŠ å¯†è§£å¯†æµ‹è¯•
- æ–‡ä»¶åŠ å¯†è§£å¯†æµ‹è¯•
- ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
=== SM2 ECDH + ZUC åŠ å¯†æµ‹è¯•ç¨‹åº ===
æµ‹è¯•æ—¶é—´: 2025-07-07

=== SM2 å¯†é’¥ç”Ÿæˆæµ‹è¯• ===
[âœ“] SM2 å¯†é’¥ç”Ÿæˆ PASSED

=== SM2 ECDH å¯†é’¥åå•†æµ‹è¯• ===
[âœ“] ECDH å¯†é’¥åå•†æ­£ç¡®æ€§ PASSED

=== ZUC åŠ å¯†è§£å¯†æµ‹è¯• ===
[âœ“] ZUC åŠ å¯†è§£å¯† PASSED

=== æ–‡ä»¶åŠ å¯†è§£å¯†æµ‹è¯• ===
[âœ“] æ–‡ä»¶åŠ å¯†è§£å¯† PASSED

=== ç«¯åˆ°ç«¯æµ‹è¯• ===
[âœ“] ç«¯åˆ°ç«¯åŠ å¯†è§£å¯† PASSED

=== æµ‹è¯•ç»Ÿè®¡ ===
æ€»æµ‹è¯•æ•°: 5
é€šè¿‡: 5
å¤±è´¥: 0
æˆåŠŸç‡: 100.0%
```

### 2. æ€§èƒ½æµ‹è¯•

```bash
python3 test/test_perf.py
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
   Size (bytes) |  Enc Time (ms) |  Dec Time (ms) | OK?
-------------------------------------------------------
           128 |          0.25  |         0.21   | âœ…
           256 |          0.31  |         0.28   | âœ…
           512 |          0.45  |         0.42   | âœ…
          1024 |          0.78  |         0.75   | âœ…
          2048 |          1.23  |         1.19   | âœ…
          4096 |          2.34  |         2.28   | âœ…
          8192 |          4.56  |         4.48   | âœ…
         16384 |          8.91  |         8.76   | âœ…
         32768 |         17.23  |        16.98   | âœ…
         65536 |         33.45  |        32.89   | âœ…
```

---

## ğŸ§¹ æ¸…ç†æ–¹æ³•

### æ¸…ç†ç¼–è¯‘äº§ç‰©
```bash
make clean
```

### æ¸…ç†æµ‹è¯•äº§ç‰©
```bash
rm -rf test/data/*
```

### æ¸…ç†æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶
```bash
make clean
rm -rf test/data/*
rm -f *.pem *.key *.zuc *.txt
```

---

## ğŸ“¦ æ‰“åŒ…åˆ†å‘

```bash
./package.sh
```

ç”Ÿæˆ `e2e-tool-package.zip`ï¼ŒåŒ…å«ï¼š
- `e2e-tool`ï¼ˆé™æ€é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼‰
- `README.md`
- `test_perf.py`

---

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### åŠ å¯†ç®—æ³•
- **SM2**ï¼šå›½å¯†æ¤­åœ†æ›²çº¿å…¬é’¥å¯†ç ç®—æ³•
- **ZUC**ï¼šå›½å¯†æµå¯†ç ç®—æ³•
- **ECDH**ï¼šæ¤­åœ†æ›²çº¿ Diffie-Hellman å¯†é’¥åå•†

### å®‰å…¨ç‰¹æ€§
- é™æ€é“¾æ¥ GmSSLï¼Œæ— åŠ¨æ€åº“ä¾èµ–
- ä½¿ç”¨ç³»ç»Ÿå®‰å…¨éšæœºæ•°æºç”Ÿæˆå¯†é’¥
- æ”¯æŒ PEM æ ¼å¼å¯†é’¥æ–‡ä»¶
- 64 å­—èŠ‚ï¼ˆ512 ä½ï¼‰ä¼šè¯å¯†é’¥è¾“å‡º

### æ€§èƒ½ç‰¹æ€§
- æ”¯æŒå¤§æ–‡ä»¶åŠ å¯†ï¼ˆæµ‹è¯•åˆ° 4MBï¼‰
- æµå¼åŠ å¯†ï¼Œå†…å­˜å ç”¨æ’å®š
- åŠ å¯†è§£å¯†æ€§èƒ½å¯¹ç§°

---

## ğŸ“œ License

æœ¬é¡¹ç›®ä¸ºç ”ç©¶ç”¨é€”æ„å»ºï¼Œä½¿ç”¨ GmSSL é¡¹ç›®ä½œä¸ºåº•å±‚åŠ å¯†å¼•æ“ã€‚è¯·éµå¾ª GmSSL çš„ä½¿ç”¨ä¸åˆ†å‘è®¸å¯ã€‚

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›é¡¹ç›®ï¼

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ GitHub Issues è”ç³»ã€‚

